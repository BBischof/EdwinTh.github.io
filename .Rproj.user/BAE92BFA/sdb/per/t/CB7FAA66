{
    "collab_server" : "",
    "contents" : "---\nlayout: post\ncategories: blog\ntitle: Builiding a column selecter\nbase-url: https://EdwinTh.github.io\ntags: [Shiny gadget, column selection, R]\n---\n\n```{r, echo = FALSE, message = FALSE}\nlibrary(shiny)\nlibrary(miniUI)\nlibrary(dplyr)\nlibrary(DT)\ncol_select <- function(df,\n                       ret = c(\"df_select\", \"dplyr_code\"),\n                       top_n = 100) {\n  ret <- match.arg(ret)\n  stopifnot(is.data.frame(df))\n  df_head <- head(df, top_n)\n\n  ui <- miniPage(\n    gadgetTitleBar(\"Have your pick\"),\n    miniContentPanel(\n      dataTableOutput(\"selection_df\", height = \"100%\")\n    )\n  )\n\n  server <- function(input, output, session){\n    options(DT.options = list(pageLength = 10))\n    output$selection_df <- DT::renderDataTable(\n      df_head, server = FALSE, selection = list(target = \"column\")\n    )\n    observeEvent(input$done, stopApp(  input$selection_df_columns_selected))\n  }\n\n  cols_selected <- runGadget(ui, server)\n\n  if (ret == \"df_select\") {\n    return( df %>% select(cols_selected) )\n  } else {\n    df_name <- deparse(substitute(df))\n    colnames_selected <-  colnames(df)[cols_selected] %>%\n      paste(collapse = \", \")\n    rstudioapi::insertText(\n      paste(df_name, \" %>% select(\", colnames_selected, \")\", sep = \"\")\n    )\n  }\n}\n```\n\nMaybe the following sounds familiar. You have a large data set with many, many columns of which the most are irrelevant to you. Typically, a dump from a database or the full set extracted from an API. Several times I found myself the better part of an afternoon going back and forth between a view of the data where I tried to figure out which columns to keep, and an R session where I wrote the code for creating the subset of columns. Wouldn't it be nice to have an app in which you could just click the columns you would like to keep? This seemed a perfect opportunity to get my feet wet with Shiny gadgets, which I still wanted to do since I first heard about it on useR2016.\n\nI did not really have a feel for how difficult it would be to build something like this. All I knew was that I probably needed `DT` to show an interactive data frame. Well it proved very easy to build a tool like this, I was just baffled by how easy it was. Due to the fine documentation of the Shiny functionalities, and excellent examples by [Yihui Xie](https://yihui.shinyapps.io/DT-selection/) and [Joe Cheng](http://shiny.rstudio.com/articles/gadgets.html), I had it working before I knew it. You have to give it up to these guys from RStudio. When you enable someone with barely any knowledge of JavaScript, CSS and html to build an app in a few hours, you certainly are doing something right.\n\nYou simply run the function `col_select` on a data frame and the mini ui opens. You click the columns you want to keep and store these in a new object like this:\n\n```{r, eval = FALSE}\nBatting_rel <- col_select(Lahman::Batting)\n```\n\n![Screenshot](/images/2016-11-26-col_sel_screenshot.png)\n\nThe downside of applying the function in this way is its lack of reproducibility. Therefore, it is possible to return the `dplyr` code that makes the selection, instead of the selection itself. The code will be inserted in the R script. In the next example the second line is inserted by running the app and selecting the first four columns.\n\n```{r, eval = FALSE}\ncol_select(Lahman::Batting, ret = 'dplyr_code')\nLahman::Batting %>% select(playerID, yearID, stint, teamID)\n```\n\nHere is the full code for the function. You will notice a third parameter with which you select how many rows are shown in the app. The code can also be found in the [R-package that accompanies this blog](https://github.com/edwinth/thatssorandom). The functions from my last post about [designing our bathroom with R](https://edwinth.github.io/blog/bathroom-with-r/) are now made available here as well.\n\n```{r, message = FALSE}\nlibrary(shiny)\nlibrary(miniUI)\nlibrary(dplyr)\nlibrary(DT)\ncol_select <- function(df,\n                       ret = c(\"df_select\", \"dplyr_code\"),\n                       top_n = 100) {\n  ret <- match.arg(ret)\n  stopifnot(is.data.frame(df))\n  df_head <- head(df, top_n)\n\n  ui <- miniPage(\n    gadgetTitleBar(\"Have your pick\"),\n    miniContentPanel(\n      dataTableOutput(\"selection_df\", height = \"100%\")\n    )\n  )\n\n  server <- function(input, output, session){\n    options(DT.options = list(pageLength = 10))\n    output$selection_df <- renderDataTable(\n      df_head, server = FALSE, selection = list(target = \"column\")\n    )\n    observeEvent(input$done, stopApp(  input$selection_df_columns_selected))\n  }\n\n  cols_selected <- runGadget(ui, server)\n\n  if (ret == \"df_select\") {\n    return( df %>% select(cols_selected) )\n  } else {\n    df_name <- deparse(substitute(df))\n    colnames_selected <-  colnames(df)[cols_selected] %>%\n      paste(collapse = \", \")\n    rstudioapi::insertText(\n      paste(df_name, \" %>% select(\", colnames_selected, \")\", sep = \"\")\n    )\n  }\n}\n```\n\n\n\n",
    "created" : 1480194261819.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2621447862",
    "id" : "CB7FAA66",
    "lastKnownWriteTime" : 1480194347,
    "last_content_update" : 1480194347876,
    "path" : "~/Documents/Site/_source/2016-11-26-column-selecter.Rmd",
    "project_path" : "_source/2016-11-26-column-selecter.Rmd",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}